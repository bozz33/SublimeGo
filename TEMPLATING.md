# Templating Guide

SublimeGo uses [Templ](https://templ.guide/)  a type-safe, compiled HTML templating language for Go.
Templates are defined in `.templ` files and compiled to plain Go code.

---

## Why Templ?

- **Type-safe**  template arguments are checked at compile time, not at runtime.
- **No reflection**  compiled to Go functions, zero runtime overhead.
- **IDE support**  full autocomplete and error highlighting via the Templ LSP.
- **XSS-safe**  all values are escaped by default; raw HTML requires an explicit opt-in.

---

## Installation

```bash
go install github.com/a-h/templ/cmd/templ@latest
```

Or via Make:

```bash
make install-tools
```

---

## Workflow

### 1. Create a `.templ` file

```templ
// views/products/card.templ
package products

import "github.com/bozz33/sublimego/internal/ent"

templ ProductCard(p *ent.Product) {
    <div class="rounded-lg border p-4 shadow-sm">
        <h2 class="text-lg font-semibold">{ p.Name }</h2>
        <p class="text-gray-500">{ p.Description }</p>
        <span class="font-bold">${ fmt.Sprintf("%.2f", p.Price) }</span>
    </div>
}
```

### 2. Generate Go code

```bash
templ generate
# or
make generate
```

This creates `views/products/card_templ.go`  do not edit this file manually.

### 3. Use in a handler

```go
func (h *Handler) ShowCard(w http.ResponseWriter, r *http.Request) {
    product, _ := h.db.Product.Get(r.Context(), id)
    products.ProductCard(product).Render(r.Context(), w)
}
```

---

## Syntax Reference

### Variables

```templ
<p>{ user.Name }</p>
<p>{ fmt.Sprintf("$%.2f", product.Price) }</p>
```

### Conditionals

```templ
if user.IsAdmin() {
    <span class="badge">Admin</span>
}

if product.Status == "published" {
    <span class="text-green-600">Live</span>
} else {
    <span class="text-gray-400">Draft</span>
}
```

### Loops

```templ
for _, item := range items {
    <li>{ item.Name }</li>
}

for i, item := range items {
    <li>{ strconv.Itoa(i+1) }. { item.Name }</li>
}
```

### Components

```templ
// Define
templ Button(label string, variant string) {
    <button class={ buttonClass(variant) }>{ label }</button>
}

// Use
@Button("Save", "primary")
@Button("Cancel", "secondary")
```

### Children / Slots

```templ
templ Card(title string) {
    <div class="card">
        <h3>{ title }</h3>
        <div class="card-body">
            { children... }
        </div>
    </div>
}

// Usage
@Card("My Card") {
    <p>Content goes here</p>
}
```

### Raw HTML (use with caution)

```templ
// Only use for trusted, already-sanitized HTML
@templ.Raw(trustedHTMLString)
```

### CSS classes with logic

```templ
templ StatusBadge(status string) {
    <span class={ badgeClass(status) }>{ status }</span>
}

func badgeClass(status string) string {
    switch status {
    case "published":
        return "bg-green-100 text-green-800 px-2 py-1 rounded"
    case "draft":
        return "bg-gray-100 text-gray-800 px-2 py-1 rounded"
    default:
        return "bg-red-100 text-red-800 px-2 py-1 rounded"
    }
}
```

---

## SublimeGo UI Components

### Atoms (`ui/atoms/`)

Pre-built atomic components available in all templates:

```templ
// Badge
@atoms.Badge(atoms.BadgeProps{Label: "Active", Color: "green"})

// Button
@atoms.Button(atoms.ButtonProps{Label: "Save", Variant: "primary"})

// Modal
@atoms.Modal(atoms.ModalProps{ID: "confirm-delete", Title: "Confirm"}) {
    <p>Are you sure?</p>
}

// Tabs
@atoms.Tabs(atoms.TabsProps{
    Items: []atoms.TabItem{
        {ID: "general", Label: "General", Active: true},
        {ID: "advanced", Label: "Advanced"},
    },
    Style: "underline",
})

// Steps / Wizard
@atoms.Steps(atoms.StepsProps{
    Steps: []atoms.Step{
        {ID: "1", Label: "Account",  Status: atoms.StepCompleted},
        {ID: "2", Label: "Profile",  Status: atoms.StepCurrent},
        {ID: "3", Label: "Confirm",  Status: atoms.StepUpcoming},
    },
    Orientation: "horizontal",
})

// Alert
@atoms.Alert(atoms.AlertProps{
    Level:   "success",
    Title:   "Saved",
    Message: "Your changes have been saved.",
})
```

### Layouts (`ui/layouts/`)

```templ
// Base layout  wraps all admin pages
@layouts.Base(layouts.BaseProps{Title: "Products"}) {
    // page content
}

// Sidebar navigation
@layouts.Sidebar(layouts.SidebarProps{Items: navItems})

// Topbar
@layouts.Topbar(layouts.TopbarProps{User: currentUser})
```

### Generic Views (`views/generics/`)

```templ
// Table view  rendered by the engine for List pages
@generics.List(tableState)

// Form view  rendered by the engine for Create/Edit pages
@generics.Form(formState)

// Infolist view  rendered by the engine for View pages
@generics.Infolist(infolistState)
```

---

## Render Hooks in Templates

```templ
import "github.com/bozz33/sublimego/hooks"

templ MyLayout() {
    <html>
    <head>
        if hooks.Has(hooks.InHead) {
            @hooks.Render(hooks.InHead)
        }
    </head>
    <body>
        if hooks.Has(hooks.BeforeContent) {
            @hooks.Render(hooks.BeforeContent)
        }
        { children... }
        if hooks.Has(hooks.AfterContent) {
            @hooks.Render(hooks.AfterContent)
        }
    </body>
    </html>
}
```

---

## Dark Mode

All built-in components support Tailwind CSS dark mode via the `dark:` prefix.
Dark mode is toggled by Alpine.js and stored in `localStorage`.

```templ
<div class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">
    { content }
</div>
```

---

## Development Tips

- Run `make generate` (or `templ generate`) after every `.templ` file change.
- In development, use `make dev`  air watches for changes and re-runs `templ generate` automatically.
- Never edit `*_templ.go` files  they are regenerated and your changes will be lost.
- Use `templ fmt .` to format all `.templ` files consistently.

---

## Further Reading

- [Templ documentation](https://templ.guide/)
- [Templ GitHub](https://github.com/a-h/templ)
- [ARCHITECTURE.md](ARCHITECTURE.md)  how templates fit into the overall architecture
